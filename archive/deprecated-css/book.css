/**
 * VistaKine Book Layout Styles
 *
 * This file contains:
 * - Book-specific layout and components
 * - Sidebar and its components (including search)
 * - Content sections and chapter styling
 * - Book-specific interactive elements
 * - Loading states and error messages
 *
 * Note: Global styles and general UI components are in main.css
 * Sidebar-specific elements use the .sidebar prefix to prevent
 * conflicts with similar components in main.css
 */

/* CSS Variables for consistent theming */
:root {
	/* Spacing variables */
	--spacing-xs: 0.25rem;
	--spacing-sm: 0.5rem;
	--spacing-md: 1rem;
	--spacing-lg: 1.5rem;
	--spacing-xl: 2rem;
	--spacing-xxl: 3rem;

	/* Font sizes */
	--text-xs: 0.75rem;
	--text-sm: 0.875rem;
	--text-base: 1rem;
	--text-lg: 1.125rem;
	--text-xl: 1.25rem;
	--text-2xl: 1.5rem;
	--text-3xl: 1.875rem;
	--text-4xl: 2.25rem;

	/* Colors */
	--primary-color: #2563eb;
	--primary-color-rgb: 37, 99, 235;
	--accent-color: #3b82f6;
	--accent-color-dark: #1d4ed8;
	--text-color: #333;
	--text-light: #666;
	--border-color: #e5e7eb;
	--hover-bg: rgba(0, 0, 0, 0.04);
	--hover-color: #d1d5db;
	--active-bg: rgba(37, 99, 235, 0.08);

	/* Section color scheme - grayscale progression */
	--section-cover-bg: #ffffff;
	--section-about-bg: #fafafa;
	--section-chapters-bg: #f7f7f7;
	--section-chapter1-bg: #f3f3f3;
	--section-chapter2-bg: #ececec;
	--section-chapter3-bg: #e5e5e5;
	--section-chapter4-bg: #dedede;
	--section-chapter5-bg: #d7d7d7;

	/* Text color for darker backgrounds */
	--text-on-dark: #333;

	/* Other */
	--transition-fast: 0.15s ease;
	--transition-normal: 0.3s ease;
	--max-content-width: 1000px;
	--wide-content-width: 1200px;
	--sidebar-width: 300px;
	--heading-font: 'Instrument Sans', 'Inter', system-ui, sans-serif;

	/* Shadows */
	--shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
	--shadow-md: 0 2px 10px rgba(0, 0, 0, 0.05);
	--shadow-lg: 0 5px 15px rgba(0, 0, 0, 0.1);

	/* Transitions */
	--search-icon-opacity: 1;

	/* Layout */
	--sidebar-collapsed-width: 10px;
}

/* ========== LAYOUT & STRUCTURE ========== */

/* Main content area */
#book-content {
	flex: 1;
	position: relative;
	margin-left: var(--sidebar-width);
	min-height: 100vh;
	transition: margin-left 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
	overflow-x: hidden;
	overflow-y: auto;
	scroll-behavior: smooth;
	padding-bottom: 100px;
}

.section-container {
	min-height: auto;
	padding: var(--spacing-xl);
	border-bottom: 1px solid #eee;
	scroll-margin-top: var(--spacing-md);
	background-color: #f9fafb;
	transition: background-color 0.5s ease;
}

/* Section container background colors */
#cover.section-container {
	background-color: rgba(255, 255, 255, 0.7);
}

#about.section-container {
	background-color: rgba(250, 250, 250, 0.7);
}

#chapters.section-container {
	background-color: rgba(247, 247, 247, 0.7);
}

/* Chapter 1 sections container backgrounds */
#chapter1-intro.section-container,
#chapter1-coordinates.section-container,
#chapter1-matrices.section-container,
#chapter1-matrix-lab.section-container {
	background-color: rgba(243, 243, 243, 0.7);
}

/* Chapter 2 sections container backgrounds */
#chapter2-intro.section-container,
#chapter2-operations.section-container,
#chapter2-dot-products.section-container,
#chapter2-applications.section-container {
	background-color: rgba(236, 236, 236, 0.7);
}

/* Chapter 3 sections container backgrounds */
#chapter3-definition.section-container,
#chapter3-geometric.section-container,
#chapter3-applications.section-container,
#chapter3-triple.section-container {
	background-color: rgba(229, 229, 229, 0.7);
}

.section-container:last-child {
	border-bottom: none;
}

.section-container.active {
	background-color: rgba(52, 152, 219, 0.05);
}

/* Common content containers */
.section-content {
	max-width: var(--wide-content-width);
	margin: var(--spacing-md) auto;
}

/* Section inner styling - paper-like elevation */
.section-inner {
	background-color: #ffffff;
	border-radius: 8px;
	box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.03);
	padding: var(--spacing-lg);
	margin-bottom: var(--spacing-lg);
	transition: box-shadow 0.3s ease, transform 0.3s ease, background-color 0.3s ease;
	position: relative;
}

/* Grayscale background color scheme for sections */
#cover .section-inner {
	background-color: var(--section-cover-bg);
}

#about .section-inner {
	background-color: var(--section-about-bg);
}

#chapters .section-inner {
	background-color: var(--section-chapters-bg);
}

/* Chapter 1 sections */
#chapter1-intro .section-inner,
#chapter1-coordinates .section-inner,
#chapter1-matrices .section-inner,
#chapter1-matrix-lab .section-inner {
	background-color: var(--section-chapter1-bg);
}

/* Chapter 2 sections */
#chapter2-intro .section-inner,
#chapter2-operations .section-inner,
#chapter2-dot-products .section-inner,
#chapter2-applications .section-inner {
	background-color: var(--section-chapter2-bg);
}

/* Chapter 3 sections */
#chapter3-definition .section-inner,
#chapter3-geometric .section-inner,
#chapter3-applications .section-inner,
#chapter3-triple .section-inner {
	background-color: var(--section-chapter3-bg);
}

/* Section header indicator - small colored bar that matches section background */
.content-header::before {
	content: "";
	display: block;
	width: 50px;
	height: 5px;
	margin-bottom: var(--spacing-md);
	border-radius: 2px;
	background-color: inherit;
	opacity: 0.7;
}

.section-inner:hover {
	box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1), 0 3px 12px rgba(0, 0, 0, 0.05);
	transform: translateY(-2px);
}

/* Apply consistent max-width to all content pages */
.content-page,
.about-page,
.chapter-page,
.chapters-page,
.vectors-page,
.cross-products-page,
.section-page {
	max-width: var(--max-content-width);
	margin: 0 auto;
}

/* Reading progress indicator */
.reading-progress {
	position: fixed;
	top: 0;
	left: 0;
	width: 0%;
	height: 4px;
	background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
	z-index: 1000;
	transition: width 0.2s ease;
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Reading time estimator */
.reading-time {
	display: flex;
	align-items: center;
	font-size: 0.875rem;
	color: var(--text-light);
	margin-bottom: var(--spacing-md);
	line-height: 1;
}

.reading-time i {
	margin-right: 4px;
	font-size: 1rem;
	color: var(--accent-color);
}

/* Section size indicator */
.section-size {
	display: flex;
	align-items: center;
	margin-bottom: var(--spacing-md);
	font-size: 0.875rem;
	color: var(--text-light);
}

.section-size .label {
	margin-right: 8px;
	opacity: 0.85;
}

.section-size .dots {
	display: flex;
	align-items: center;
	gap: 4px;
}

.section-size .dot {
	width: 6px;
	height: 6px;
	border-radius: 50%;
	background-color: var(--border-color);
	opacity: 0.5;
	transition: transform 0.2s ease, opacity 0.2s ease;
}

.section-size .dot.active {
	background-color: var(--accent-color);
	opacity: 1;
}

/* ========== SIDEBAR ========== */

/* Sidebar base styles */
.sidebar {
	position: fixed;
	top: 0;
	left: 0;
	height: 100vh;
	width: fit-content;
	min-width: var(--sidebar-width);
	max-width: 400px;
	background-color: rgba(255, 255, 255, 0.75);
	backdrop-filter: blur(10px);
	-webkit-backdrop-filter: blur(10px);
	border-right: 1px solid rgba(255, 255, 255, 0.6);
	box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
	z-index: 100;
	display: flex;
	flex-direction: column;
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
	overflow: hidden;
	--search-icon-opacity: 1;
	transition-property: width, background-color, box-shadow, backdrop-filter;
	transition-duration: 0.4s;
	transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Logo and header styling */
.sidebar-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: var(--spacing-md);
	border-bottom: 1px solid var(--border-color);
}

.logo {
	display: flex;
	align-items: center;
	gap: var(--spacing-xs);
}

.logo i {
	font-size: 1.5rem;
	color: var(--text-color);
}

.logo h1 {
	font-size: 1.75rem;
	margin: 0;
	font-weight: 600;
	color: var(--text-color);
}

/* Search container */
.sidebar .search-container {
	padding: var(--spacing-md) var(--spacing-lg);
	margin-block: var(--spacing-lg);
	border-bottom: 1px solid var(--border-color);
	position: relative;
	transition: all 0.3s ease;
}

.sidebar .search-container input {
	width: 100%;
	padding: var(--spacing-sm) 0.75rem;
	border: 1px solid #ddd;
	border-radius: 4px;
	font-size: 0.9rem;
}

.sidebar .search-container i {
	position: absolute;
	right: 2rem;
	top: 50%;
	transform: translateY(-50%);
	color: #999;
	transition: opacity 0.3s ease;
}

/* Navigation styling */
.sidebar-nav {
	flex: 1;
	overflow-y: auto;
	padding: var(--spacing-md) 0;
	transition: all 0.3s ease;
}

/* Chapter items with circle numbers */
.nav-chapter {
	display: flex;
	align-items: center;
	position: relative;
	padding: 0.5rem 45px 0.5rem 0.75rem;
	color: var(--text-color);
	text-decoration: none;
	border-left: 3px solid transparent;
	transition: background-color 0.2s ease;
	font-weight: 500;
}

.nav-chapter:hover {
	background-color: var(--hover-bg);
	border-left-color: var(--hover-color);
}

.nav-chapter.active {
	background-color: var(--active-bg);
	border-left-color: var(--primary-color);
	color: var(--primary-color);
}

.nav-chapter.active::after {
	content: '';
	position: absolute;
	right: 12px;
	top: 50%;
	transform: translateY(-50%);
	width: 6px;
	height: 6px;
	border-radius: 50%;
	background-color: var(--primary-color);
	box-shadow: 0 0 0 2px rgba(var(--primary-color-rgb), 0.2);
}

.chapter-number {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 24px;
	height: 24px;
	background-color: #e6e6e9;
	color: var(--text-color);
	border-radius: 50%;
	margin-right: 0.75rem;
	font-size: 0.9rem;
	font-weight: 500;
}

.nav-chapter span {
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;
}

/* Subchapters */
.subchapter-list {
	margin-left: 2.5rem;
	border-left: 1px solid var(--border-color);
	padding-left: var(--spacing-md);
}

.nav-subchapter {
	display: block;
	padding: 0.5rem 45px 0.5rem 3rem;
	color: var(--text-light);
	text-decoration: none;
	position: relative;
	transition: all 0.2s ease;
	font-size: 0.9rem;
	border-left: 3px solid transparent;
}

.nav-subchapter:hover {
	background-color: var(--hover-bg);
	border-left-color: var(--hover-color);
}

.nav-subchapter.active {
	background-color: var(--active-bg);
	border-left-color: var(--primary-color);
	color: var(--primary-color);
}

.nav-subchapter.active::before {
	content: '';
	position: absolute;
	left: 1.5rem;
	top: 50%;
	transform: translateY(-50%);
	width: 4px;
	height: 4px;
	border-radius: 50%;
	background-color: var(--primary-color);
}

.nav-subchapter .page-num {
	position: absolute;
	right: 12px;
	top: 50%;
	transform: translateY(-50%);
	font-size: 0.75rem;
	color: var(--text-light);
	opacity: 0.8;
	padding: 2px 8px;
	background-color: rgba(0, 0, 0, 0.04);
	border-radius: 10px;
	display: flex;
	align-items: center;
	gap: 3px;
}

.nav-subchapter .page-num i {
	font-size: 0.7rem;
	opacity: 0.7;
}

.nav-chapter .page-num {
	position: absolute;
	right: 12px;
	top: 50%;
	transform: translateY(-50%);
	font-size: 0.75rem;
	color: var(--text-light);
	opacity: 0.8;
	padding: 2px 8px;
	background-color: rgba(0, 0, 0, 0.04);
	border-radius: 10px;
	display: flex;
	align-items: center;
	gap: 3px;
}

.nav-chapter .page-num i {
	font-size: 0.7rem;
	opacity: 0.7;
}

/* Sidebar resize handle */
.sidebar-resize-handle {
	position: absolute;
	top: 0;
	right: -5px;
	width: 10px;
	height: 100%;
	cursor: ew-resize;
	z-index: 200;
	transition: all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Pull tab */
.sidebar-resize-handle::before {
	content: "≡";
	position: absolute;
	top: 50%;
	right: 0;
	transform: translateY(-50%);
	background-color: #f0f0f0;
	color: #555;
	width: 0;
	height: 40px;
	border-radius: 0 4px 4px 0;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 18px;
	box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
	overflow: hidden;
	opacity: 0;
	transition: var(--transition-normal);
	padding: 0;
	line-height: 1;
	text-align: center;
}

/* Tooltip */
.sidebar-resize-handle::after {
	content: attr(data-tooltip);
	position: absolute;
	top: 50%;
	right: -140px;
	transform: translateY(-50%);
	background-color: rgba(0, 0, 0, 0.7);
	color: white;
	padding: 5px 10px;
	border-radius: 4px;
	font-size: 12px;
	white-space: nowrap;
	opacity: 0;
	pointer-events: none;
	transition: opacity 0.2s;
	z-index: 1000;
}

/* Collapsed sidebar states */
.sidebar.collapsed {
	width: var(--sidebar-collapsed-width) !important;
	min-width: var(--sidebar-collapsed-width);
	max-width: var(--sidebar-collapsed-width);
	background-color: rgba(255, 255, 255, 0.6);
	backdrop-filter: blur(6px);
	-webkit-backdrop-filter: blur(6px);
	border-right: 1px solid rgba(255, 255, 255, 0.8);
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

/* Hide sidebar content when collapsed */
.sidebar.collapsed .sidebar-header,
.sidebar.collapsed .search-container,
.sidebar.collapsed .sidebar-nav {
	opacity: 0;
	visibility: hidden;
}

/* Transition for smooth collapse/expand */
.sidebar,
.sidebar .sidebar-header,
.sidebar .search-container,
.sidebar .sidebar-nav,
.main-content {
	transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.sidebar.collapsed .sidebar-resize-handle::before {
	width: 24px;
	opacity: 1;
	right: -24px;
}

.sidebar.collapsed .sidebar-resize-handle:hover::before {
	background-color: var(--primary-color);
	color: white;
}

.sidebar.collapsed .sidebar-resize-handle:hover::after {
	opacity: 1;
	transition: opacity 0.2s 0.3s;
}

/* Main content with sidebar */
.main-content {
	margin-left: var(--sidebar-width);
	padding: var(--spacing-xl);
	transition-property: margin-left;
	transition-duration: 0.4s;
	transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
}

.sidebar.collapsed + .main-content,
.main-content.sidebar-collapsed {
	margin-left: var(--sidebar-collapsed-width);
}

.sidebar.collapsed + .main-content {
	margin-left: var(--sidebar-collapsed-width) !important;
}

/* Search icon opacity transition */
@media (min-width: 769px) {
	.sidebar:not(.collapsed) .search-container i {
		opacity: var(--search-icon-opacity, 1);
	}
}

/* ========== LOADING & ERROR STATES ========== */

/* Loading Placeholders */
.loading-placeholder {
	display: flex;
	align-items: center;
	justify-content: center;
	min-height: 200px;
	background-color: var(--bg-lighter);
	border-radius: 8px;
	color: var(--text-light);
	font-size: 1.2rem;
	position: relative;
	overflow: hidden;
}

.loading-placeholder::after {
	content: "";
	position: absolute;
	top: 0;
	left: -100%;
	width: 50%;
	height: 100%;
	background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.5), transparent);
	animation: loading-shimmer 1.5s infinite;
}

@keyframes loading-shimmer {
	0% {
		left: -100%;
	}

	100% {
		left: 100%;
	}
}

/* Error Messages */
.error-message {
	padding: var(--spacing-lg);
	margin: var(--spacing-md) 0;
	background-color: rgba(255, 0, 0, 0.1);
	border: 1px solid rgba(255, 0, 0, 0.3);
	border-radius: 8px;
	text-align: center;
	max-width: 600px;
	margin-left: auto;
	margin-right: auto;
}

.error-message h2 {
	color: #cc0000;
	margin-bottom: var(--spacing-md);
}

.error-message .error-details {
	font-family: monospace;
	background-color: rgba(0, 0, 0, 0.05);
	padding: var(--spacing-sm);
	border-radius: 4px;
	margin: var(--spacing-sm) 0;
	word-break: break-all;
	max-height: 100px;
	overflow-y: auto;
}

.error-message button {
	background-color: #0066cc;
	color: white;
	border: none;
	padding: 8px 16px;
	border-radius: 4px;
	cursor: pointer;
	font-weight: 500;
	margin-top: var(--spacing-md);
}

.error-message button:hover {
	background-color: #0055aa;
}

/* ========== COMMON COMPONENTS ========== */

/* Navigation buttons */
.navigation-buttons {
	display: flex;
	justify-content: space-between;
	margin-top: var(--spacing-xl);
}

.nav-button {
	display: inline-flex;
	align-items: center;
	padding: 0.8rem var(--spacing-lg);
	border-radius: 4px;
	text-decoration: none;
	font-weight: bold;
	transition: background-color 0.2s;
	background-color: #f0f0f0;
	color: var(--text-color);
}

.nav-button:hover {
	background-color: #e0e0e0;
}

.prev-button i,
.next-button i {
	font-size: 1.2rem;
}

.prev-button i {
	margin-right: var(--spacing-sm);
}

.next-button i {
	margin-left: var(--spacing-sm);
}

/* Call to action buttons */
.cta-container {
	display: flex;
	gap: var(--spacing-md);
	margin-bottom: var(--spacing-xxl);
}

.cta-button {
	padding: 0.8rem var(--spacing-lg);
	border-radius: 4px;
	font-weight: bold;
	text-decoration: none;
	transition: var(--transition-fast);
}

.cta-button.primary {
	background-color: var(--primary-color);
	color: white;
}

.cta-button.primary:hover {
	background-color: var(--primary-dark);
}

.cta-button.secondary {
	background-color: var(--bg-lighter);
	color: var(--text-color);
}

.cta-button.secondary:hover {
	background-color: #e0e0e0;
}

/* Content headers */
.content-header {
	margin-bottom: var(--spacing-xl);
	max-width: 68ch;
	margin-left: auto;
	margin-right: auto;
}

.content-header h1 {
	line-height: 1.3;
	margin: 0;
	font-size: 2.5rem;
	color: var(--text-color);
	margin-bottom: var(--spacing-sm);
}

.content-header h2 {
	margin: 0;
	font-size: 2.5rem;
	line-height: 1.3;
}

.content-header .subtitle {
	color: var(--text-light);
	font-size: 1.2rem;
	margin-top: var(--spacing-sm);
	line-height: 1.5;
}

/* Content sections */
.content-section {
	margin-bottom: var(--spacing-xxl);
	padding: var(--spacing-md) var(--spacing-lg);
	border-radius: 6px;
	background-color: #ffffff;
	border-left: 4px solid var(--accent-color);
	box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
	transition: box-shadow 0.2s ease;
}

.content-section:hover {
	box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

.content-section h2,
.content-section h3 {
	margin-top: 0;
	margin-bottom: var(--spacing-md);
	color: var(--text-color);
}

/* Optimized text container for readability */
.section-text {
	max-width: 68ch;
	/* Optimal line length for readability - approx 66 characters */
	margin: 0 auto var(--spacing-lg) auto;
	color: var(--text-color);
	margin-bottom: var(--spacing-md);
}

.section-text p {
	margin-bottom: var(--spacing-sm);
	font-size: 16px;
	line-height: 1.6;
}

/* Ensure consistent paragraph spacing and line length */
.section-text:last-child p:last-child {
	margin-bottom: 0;
}

/* Card style elements */
.card-element {
	background-color: #f9f9f9;
	border-radius: 8px;
	padding: var(--spacing-lg);
	margin-bottom: var(--spacing-xl);
	box-shadow: var(--shadow-sm);
}

/* Visualization containers */
.visualization-container {
	width: 100%;
	height: 300px;
	background-color: #f5f5f5;
	border-radius: 6px;
	margin: var(--spacing-sm) 0 var(--spacing-md) 0;
	position: relative;
	overflow: hidden;
	transition: all 0.3s ease;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

.visualization-container canvas {
	display: block;
	width: 100%;
	height: 100%;
}

/* Fullscreen state for visualization container */
.visualization-container.fullscreen {
	position: fixed;
	top: 0;
	left: 0;
	width: 100vw;
	height: 100vh;
	z-index: 9999;
	margin: 0;
	border-radius: 0;
	background-color: white;
	box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
}

/* Ensure canvas fills the container in fullscreen mode */
.visualization-container.fullscreen canvas {
	width: 100% !important;
	height: 100% !important;
	position: absolute;
	top: 0;
	left: 0;
}

/* Expand button for visualization */
.viz-expand-button {
	position: absolute;
	top: 8px;
	right: 8px;
	background-color: rgba(255, 255, 255, 0.7);
	border: none;
	border-radius: 4px;
	width: 32px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	z-index: 10;
	transition: background-color 0.2s ease;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.viz-expand-button:hover {
	background-color: rgba(255, 255, 255, 0.9);
}

.viz-expand-button i {
	font-size: 18px;
	color: #333;
}

/* Close button for fullscreen mode */
.viz-close-button {
	position: absolute;
	top: 16px;
	right: 16px;
	background-color: rgba(255, 255, 255, 0.8);
	border: none;
	border-radius: 4px;
	width: 32px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	z-index: 20;
	/* Higher than expand button */
	transition: background-color 0.2s ease;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.viz-close-button:hover {
	background-color: rgba(255, 255, 255, 1);
}

.viz-close-button i {
	font-size: 18px;
	color: #333;
}

/* Grid toggle button */
.viz-grid-toggle {
	position: absolute;
	top: 8px;
	right: 48px;
	/* Positioned to the left of expand button */
	background-color: rgba(255, 255, 255, 0.7);
	border: none;
	border-radius: 4px;
	width: 32px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	z-index: 10;
	transition: background-color 0.2s ease;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.viz-grid-toggle:hover {
	background-color: rgba(255, 255, 255, 0.9);
}

.viz-grid-toggle i {
	font-size: 18px;
	color: #333;
}

.visualization-container.fullscreen .viz-grid-toggle {
	top: 16px;
	right: 64px;
}

.visualization-container.fullscreen .viz-expand-button {
	display: none;
}

/* Visualization message (for errors or loading) */
.viz-message {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	background-color: rgba(255, 255, 255, 0.9);
	padding: 15px 20px;
	border-radius: 8px;
	font-size: 14px;
	color: #333;
	text-align: center;
	max-width: 80%;
}

.section-preview-card .visualization-container {
	height: 200px;
	margin: 0;
}

/* ========== PAGE SPECIFIC STYLES ========== */

/* Cover Page */
.cover-page {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	min-height: 90vh;
	text-align: center;
	padding: var(--spacing-xl);
}

.cover-hero {
	margin-bottom: var(--spacing-xxl);
}

/* Adjust cover page height for mobile devices to prevent layout shifts */
@media (max-width: 480px) {
	.cover-page {
		min-height: 500px;
		/* Fixed height instead of viewport units */
		height: auto;
		padding: var(--spacing-lg);
	}

	.cover-hero {
		margin-bottom: var(--spacing-xl);
	}
}

.logo-container {
	display: flex;
	align-items: center;
	justify-content: center;
	margin-bottom: var(--spacing-md);
}

.logo-container i {
	font-size: 3rem;
	margin-right: var(--spacing-md);
	color: var(--primary-color);
}

.logo-container h1 {
	font-size: 3.5rem;
	margin: 0;
}

.tagline {
	font-size: 1.5rem;
	color: var(--text-light);
	margin: 0;
}

.lead-text {
	font-size: 1.8rem;
	max-width: 800px;
	margin: 0 auto var(--spacing-xl);
	line-height: 1.4;
}

.feature-list {
	display: flex;
	flex-wrap: wrap;
	justify-content: center;
	gap: var(--spacing-xl);
	max-width: var(--wide-content-width);
}

.feature-item {
	flex: 1;
	min-width: 250px;
	max-width: 350px;
	padding: var(--spacing-lg);
	background-color: white;
	border-radius: 12px;
	text-align: center;
	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
	transition: all 0.3s ease;
	border-top: 4px solid var(--primary-color);
	position: relative;
	overflow: hidden;
}

.feature-item:hover {
	transform: translateY(-5px);
	box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
}

.feature-item i {
	font-size: 2.5rem;
	color: var(--primary-color);
	margin-bottom: var(--spacing-md);
	background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
	-webkit-background-clip: text;
	background-clip: text;
	color: transparent;
	transform: scale(1);
	transition: transform 0.3s ease;
}

.feature-item:hover i {
	transform: scale(1.1);
}

.feature-item h3 {
	margin: 0 0 var(--spacing-sm);
	font-weight: 600;
	color: var(--text-color);
}

.feature-item p {
	color: var(--text-light);
	margin: 0;
	line-height: 1.5;
}

/* About Page */
.about-hero {
	margin-bottom: var(--spacing-xl);
	border-radius: 8px;
	overflow: hidden;
}

.about-hero img {
	width: 100%;
	height: auto;
	display: block;
}

.about-section {
	margin-bottom: var(--spacing-xxl);
}

.about-section h3 {
	font-size: 1.8rem;
	margin: 0 0 var(--spacing-md);
	color: var(--primary-color);
}

.about-text p {
	margin: 0 0 var(--spacing-md);
	line-height: 1.6;
}

.about-text ul {
	padding-left: var(--spacing-lg);
}

.about-text li {
	margin-bottom: var(--spacing-sm);
}

.contact-link {
	color: var(--primary-color);
	text-decoration: none;
	font-weight: bold;
}

.contact-link:hover {
	text-decoration: underline;
}

/* Chapter Page */
.chapter-description {
	font-size: 1.2rem;
	color: var(--text-light);
	margin-top: var(--spacing-sm);
}

.chapter-intro {
	margin: var(--spacing-xl) 0;
	padding: var(--spacing-lg);
	background-color: #f9f9f9;
	border-radius: 8px;
	line-height: 1.6;
}

.learning-objectives {
	margin-top: var(--spacing-lg);
}

.learning-objectives h3 {
	font-size: 1.5rem;
	color: var(--primary-color);
	margin-bottom: var(--spacing-md);
}

.learning-objectives ul {
	padding-left: var(--spacing-lg);
}

.learning-objectives li {
	margin-bottom: var(--spacing-sm);
}

.chapter-sections {
	margin: var(--spacing-xxl) 0;
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
	gap: var(--spacing-xl);
}

.section-preview-card {
	background-color: #fff;
	border-radius: 8px;
	padding: var(--spacing-lg);
	box-shadow: var(--shadow-md);
	transition: transform 0.2s, box-shadow 0.2s;
}

.section-preview-card:hover {
	transform: translateY(-5px);
	box-shadow: var(--shadow-lg);
}

.section-preview-card h3 {
	margin: 0 0 var(--spacing-md);
	font-size: 1.5rem;
}

.section-preview-card h3 a {
	color: var(--primary-color);
	text-decoration: none;
	transition: color 0.2s;
}

.section-preview-card h3 a:hover {
	color: var(--primary-dark);
	text-decoration: underline;
}

.section-preview-card p {
	margin-bottom: var(--spacing-lg);
	color: var(--text-light);
}

.chapter-summary {
	margin-top: var(--spacing-xxl);
	padding: var(--spacing-lg);
	background-color: #f5f7fa;
	border-radius: 8px;
	line-height: 1.6;
}

.chapter-summary h3 {
	font-size: 1.5rem;
	color: var(--primary-color);
	margin: 0 0 var(--spacing-md);
}

/* Chapters Page */
.chapter-section {
	margin-bottom: var(--spacing-xxl);
	padding-bottom: var(--spacing-xl);
	border-bottom: 1px solid #eee;
}

.chapter-section:last-child {
	border-bottom: none;
}

.chapter-section h3 {
	font-size: 1.8rem;
	margin: 0 0 var(--spacing-md);
	color: var(--primary-color);
}

.section-preview {
	background-color: #f9f9f9;
	border-radius: 8px;
	padding: var(--spacing-lg);
	margin-top: var(--spacing-md);
}

.section-preview ul {
	padding-left: var(--spacing-lg);
	margin-bottom: var(--spacing-lg);
}

.section-preview li {
	margin-bottom: var(--spacing-sm);
}

/* Vector and Cross Products Pages */
.law-card,
.application-card {
	background-color: #f9f9f9;
	border-radius: 8px;
	padding: var(--spacing-lg);
	margin-bottom: var(--spacing-xl);
	box-shadow: var(--shadow-sm);
}

.law-card h4,
.application-card h4 {
	margin: 0 0 var(--spacing-md);
	color: var(--primary-color);
	font-size: 1.4rem;
}

.formula-container {
	background-color: var(--bg-lighter);
	border-radius: 8px;
	padding: var(--spacing-lg);
	margin: var(--spacing-lg) 0;
	text-align: center;
}

.formula {
	font-size: 1.4rem;
	margin: var(--spacing-md) 0;
	font-weight: bold;
}

.properties-list {
	background-color: #f9f9f9;
	border-radius: 8px;
	padding: var(--spacing-lg) var(--spacing-lg) var(--spacing-lg) 3rem;
	margin: var(--spacing-lg) 0;
}

.properties-list li {
	margin-bottom: var(--spacing-md);
}

.applications-grid {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
	gap: var(--spacing-lg);
	margin-top: var(--spacing-lg);
}

/* ========== RESPONSIVE STYLES ========== */

/* Mobile Toggle Button - removed as we're now using FAB instead */

.show-nav-toggle {
	display: none !important;
	/* Hide by default on all devices */
}

/* Shared mobile styles for both phones and tablets */
@media (max-width: 768px) {

	/* Hide reading progress on mobile devices */
	.reading-progress {
		display: none;
	}

	/* Make sidebar overlay the content */
	.sidebar {
		position: fixed;
		top: 0;
		left: -350px;
		/* Start off-screen */
		width: 300px;
		/* Fixed width for predictable behavior */
		min-width: auto;
		/* Reset min-width */
		max-width: 350px;
		height: 100%;
		background-color: rgba(255, 255, 255, 0.8);
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
		z-index: 1000;
		box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
		border-right: 1px solid rgba(255, 255, 255, 0.7);
		transition: transform 0.3s ease, left 0.3s ease;
		padding: var(--spacing-sm);
		overflow-y: auto;
	}

	.sidebar.active {
		left: 0;
	}

	/* Main content doesn't shift on mobile */
	#book-content {
		margin-left: 0 !important;
		width: 100%;
	}

	/* Add close button for sidebar */
	.sidebar-close {
		display: flex !important;
		position: absolute;
		top: 15px;
		right: 15px;
		width: 36px;
		height: 36px;
		background-color: transparent;
		color: var(--text-color);
		border-radius: 50%;
		align-items: center;
		justify-content: center;
		z-index: 10;
		cursor: pointer;
		transition: background-color 0.2s ease;
	}

	.sidebar-close:hover {
		background-color: rgba(0, 0, 0, 0.05);
	}

	/* Hide resize handle */
	.sidebar-resize-handle {
		display: none !important;
	}

	/* Adjust content section layout for mobile */
	.content-section {
		padding: var(--spacing-md);
		margin-bottom: var(--spacing-lg);
		border-radius: 0;
	}

	/* Typography adjustments for mobile */
	.section-text {
		font-size: 15px;
	}

	.section-text p {
		line-height: 1.5;
	}

	/* Visualization container adjustments for mobile */
	.visualization-container {
		height: 300px;
		margin: var(--spacing-md) 0;
	}

	/* Bottom navigation adjustments */
	.bottom-nav {
		padding: 0 var(--spacing-sm);
	}

	/* Table adjustments for mobile */
	table {
		font-size: 14px;
		min-width: 100%;
	}
}

/* Mobile styles - phones and small devices */
@media (max-width: 480px) {

	/* Phone-specific sidebar adjustments */
	.sidebar {
		width: 85%;
	}

	/* Additional phone-specific adjustments */
	.section-inner {
		padding: var(--spacing-sm);
	}

	.content-section {
		padding: var(--spacing-sm);
		margin-bottom: var(--spacing-md);
	}

	.visualization-container {
		height: 250px;
		/* Smaller height for phones */
	}

	.viz-grid-toggle {
		bottom: 15px;
		right: 15px;
	}

	.content-header h1 {
		font-size: 1.5rem;
	}

	.content-header .subtitle {
		font-size: 0.9rem;
	}

	/* Navigation panel */
	#chapter-nav {
		position: fixed;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background-color: rgba(255, 255, 255, 0.97);
		z-index: 100;
		overflow-y: auto;
		transition: left 0.3s ease;
		padding: var(--spacing-sm);
	}

	#chapter-nav.active {
		left: 0;
	}

	/* Book content spacing */
	#book-content {
		margin: 0;
		padding-bottom: 50px;
	}

	/* Section containers */
	.section-container {
		padding: var(--spacing-xs) 0;
		margin: 0;
	}

	/* Section content */
	.section-content {
		margin: var(--spacing-xs) auto;
	}

	/* Inner section padding */
	.section-inner {
		padding: var(--spacing-sm);
		margin-bottom: var(--spacing-sm);
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
	}

	/* Content sections */
	.content-section {
		padding: var(--spacing-md);
		margin-bottom: var(--spacing-lg);
		border-left: none !important;
		/* Remove blue highlight */
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
		border-radius: 8px;
	}

	/* Text spacing */
	.section-text {
		margin: var(--spacing-sm) var(--spacing-xs);
	}

	.section-text p {
		margin-bottom: var(--spacing-md);
		line-height: 1.8;
		font-size: 17px;
		letter-spacing: 0.01em;
	}

	.section-text ul,
	.section-text ol {
		margin-bottom: var(--spacing-md);
		padding-left: var(--spacing-md);
	}

	.section-text li {
		margin-bottom: var(--spacing-xs);
	}

	/* Header sizes */
	.content-header h1 {
		font-size: 1.6rem;
	}

	.content-header .subtitle {
		font-size: 1.1rem;
	}

	.content-section h2 {
		font-size: 1.3rem;
		margin-bottom: var(--spacing-xs);
	}

	/* Visualization containers */
	.visualization-container {
		height: 300px;
		margin: var(--spacing-sm) 0 var(--spacing-md) 0;
		border-radius: 6px;
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
	}

	/* Complete replacement of sidebar behavior for mobile */
	.sidebar {
		position: fixed;
		top: 0;
		left: -100%;
		/* Start off-screen */
		width: 85%;
		/* Keep fixed width for mobile */
		min-width: auto;
		/* Override min-width */
		max-width: 300px;
		height: 100%;
		background-color: white;
		overflow-y: auto;
		z-index: 1000;
		box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
		transition: left 0.3s ease;
		padding: var(--spacing-sm);
	}

	.sidebar.active {
		left: 0;
	}

	/* Force normal display of all sidebar elements on mobile */
	.sidebar.mini-collapsed,
	.sidebar.collapsed {
		width: 85%;
		max-width: 300px;
		left: -100%;
		/* Hide when not active */
	}

	.sidebar.mini-collapsed.active,
	.sidebar.collapsed.active {
		left: 0;
	}

	/* Ensure all sidebar content is visible */
	.sidebar .logo h1,
	.sidebar.mini-collapsed .logo h1,
	.sidebar.collapsed .logo h1,
	.sidebar .nav-chapter span,
	.sidebar.mini-collapsed .nav-chapter span,
	.sidebar.collapsed .nav-chapter span,
	.sidebar .subchapter-list,
	.sidebar.mini-collapsed .subchapter-list,
	.sidebar.collapsed .subchapter-list {
		opacity: 1;
		visibility: visible;
		width: auto;
		height: auto;
		margin: initial;
		transform: none;
		display: block;
	}

	/* Reset icon positions */
	.sidebar .logo i,
	.sidebar.mini-collapsed .logo i,
	.sidebar.collapsed .logo i,
	.sidebar .chapter-number,
	.sidebar.mini-collapsed .chapter-number,
	.sidebar.collapsed .chapter-number {
		transform: none;
		margin: initial;
	}

	/* Main content area */
	.main-content {
		margin-left: 0;
		width: 100%;
	}

	/* Hide resize handle on mobile */
	.sidebar-resize-handle {
		display: none !important;
	}

	/* Add close button for sidebar */
	.sidebar-close {
		position: absolute;
		top: 10px;
		right: 10px;
		width: 40px;
		height: 40px;
		background-color: transparent;
		color: #333333;
		border: none;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 20px;
		cursor: pointer;
		z-index: 10;
		transition: transform 0.2s ease;
	}

	.sidebar-close:hover {
		transform: scale(1.1);
	}

	/* Mobile navigation toggle button - Floating Action Button style */
	.show-nav-toggle {
		display: flex !important;
		/* Force display on mobile */
		position: fixed;
		top: 20px;
		left: 20px;
		width: 60px;
		height: 60px;
		background-color: rgba(44, 62, 80, 0.9);
		color: white;
		border-radius: 50%;
		align-items: center;
		justify-content: center;
		z-index: 9999;
		/* Ensure it's above everything */
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
		cursor: pointer;
	}

	.show-nav-toggle:hover,
	.show-nav-toggle:focus {
		background-color: rgba(44, 62, 80, 1);
		transform: scale(1.05);
	}

	.show-nav-toggle:active {
		transform: scale(0.95);
	}

	.show-nav-toggle i {
		font-size: 1.8rem;
	}

	/* Fallback text if icon doesn't load */
	.show-nav-toggle i::before {
		content: "≡";
		font-style: normal;
		font-family: Arial, sans-serif;
		font-size: 28px;
	}

	/* CTA container for mobile */
	.cta-container {
		flex-direction: column;
	}

	/* Feature list for mobile */
	.feature-list {
		flex-direction: column;
	}

	/* Feature item for mobile */
	.feature-item {
		margin-bottom: var(--spacing-sm);
	}

	/* Applications grid for mobile */
	.applications-grid {
		grid-template-columns: 1fr;
	}

	/* Chapter sections for mobile */
	.chapter-sections {
		grid-template-columns: 1fr;
	}

	/* Navigation buttons for mobile */
	.navigation-buttons {
		flex-direction: column;
		gap: var(--spacing-xs);
	}

	/* Nav buttons for mobile */
	.nav-button {
		width: 100%;
		padding: 16px;
		justify-content: center;
		min-height: 50px;
	}

	/* Page divider for mobile */
	.page-divider {
		margin: var(--spacing-sm) 0;
	}

	/* Bottom navigation for mobile */
	.bottom-nav {
		padding: var(--spacing-xs);
	}

	/* Mobile bottom navigation buttons */
	.bottom-nav-button {
		padding: 12px 16px;
		min-height: 50px;
	}

	/* Table responsiveness */
	table {
		display: block;
		width: 100%;
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
		margin: var(--spacing-sm) 0;
	}

	/* List adjustments */
	ul,
	ol {
		padding-left: 20px;
	}

	/* Code blocks */
	pre,
	code {
		font-size: 0.9rem;
		padding: 8px;
		white-space: pre-wrap;
		word-break: break-all;
	}

	/* Image responsiveness */
	img {
		max-width: 100%;
		height: auto;
	}

	/* Formula containers */
	.formula-container {
		padding: var(--spacing-xs);
		margin: var(--spacing-sm) 0;
		overflow-x: auto;
	}

	/* Interactive elements - improved touch targets */
	button,
	.cta-button,
	.nav-chapter,
	.nav-subchapter,
	.feature-item,
	.section-preview-card,
	.viz-expand-button,
	.viz-close-button,
	.viz-grid-toggle {
		min-height: 50px;
		min-width: 50px;
		padding: 14px;
		margin: 4px 0;
	}

	/* Search input for mobile */
	.search-container input {
		height: 50px;
		font-size: 16px;
		/* Prevents zoom on iOS */
		padding: 0 15px;
	}

	/* Nav items touch target enhancements */
	.nav-chapter,
	.nav-subchapter {
		margin: 8px 0;
	}

	/* Visualization controls */
	.viz-controls button {
		margin: 6px;
		padding: 14px;
		min-height: 50px;
		min-width: 50px;
	}

	/* Mobile text improvements for better readability */
	.section-text {
		margin: var(--spacing-sm) var(--spacing-xs);
	}

	.section-text p {
		margin-bottom: var(--spacing-md);
		line-height: 1.8;
		font-size: 17px;
		letter-spacing: 0.01em;
	}

	.section-text ul,
	.section-text ol {
		margin-bottom: var(--spacing-md);
		padding-left: var(--spacing-md);
	}

	.section-text li {
		margin-bottom: var(--spacing-xs);
	}

	.content-section {
		padding: var(--spacing-md);
		margin-bottom: var(--spacing-lg);
		border-left: none !important;
		/* Remove blue highlight */
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
		border-radius: 8px;
	}

	/* Improved heading spacing */
	.content-header {
		margin-bottom: var(--spacing-lg);
		padding-bottom: var(--spacing-md);
	}

	.content-section h2 {
		margin-bottom: var(--spacing-md);
		font-size: 1.5rem;
		line-height: 1.3;
	}

	/* Create more space between content sections */
	.section-inner > .content-section:not(:last-child) {
		margin-bottom: calc(var(--spacing-lg) + 10px);
	}

	/* Enhanced visualization controls for mobile */
	.viz-expand-button,
	.viz-grid-toggle,
	.viz-close-button {
		width: 44px;
		height: 44px;
		background-color: rgba(255, 255, 255, 0.85);
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
	}

	.viz-expand-button i,
	.viz-grid-toggle i,
	.viz-close-button i {
		font-size: 20px;
	}

	/* Improved touch targets for mobile */
	.visualization-container .viz-controls button {
		min-width: 40px;
		min-height: 40px;
		margin: 0 4px;
		padding: 10px;
		border-radius: 6px;
		background-color: rgba(255, 255, 255, 0.85);
	}

	/* Use a grid layout for buttons in fullscreen mode on small screens */
	.visualization-container.fullscreen .viz-controls {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
		gap: 8px;
		position: absolute;
		bottom: 16px;
		left: 16px;
		right: 16px;
		z-index: 20;
		background-color: rgba(255, 255, 255, 0.7);
		padding: 8px;
		border-radius: 8px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
	}
}

/* Extra small screens - phones */
@media (max-width: 480px) {

	/* Section containers */
	.section-container {
		padding: var(--spacing-xs) 0;
		/* Further reduced, zero horizontal padding */
	}

	/* Inner section padding */
	.section-inner {
		padding: var(--spacing-xs);
		margin-bottom: var(--spacing-xs);
		box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
		border-radius: 4px;
	}

	/* Content sections */
	.content-section {
		padding: var(--spacing-xs) 0;
		/* Zero horizontal padding */
		margin-bottom: var(--spacing-xs);
	}

	/* Increase visualization size on very small screens */
	.visualization-container {
		height: 320px;
		/* Even taller for small screens */
		margin: var(--spacing-md) 0 var(--spacing-lg) 0;
	}

	/* Expand buttons further apart on small screens */
	.viz-grid-toggle {
		right: 52px;
		/* More space between buttons */
	}

	/* Make buttons even more touch-friendly */
	.viz-expand-button,
	.viz-grid-toggle,
	.viz-close-button {
		width: 44px;
		height: 44px;
	}

	/* Header sizes for smaller screens */
	.content-header h1 {
		font-size: 1.4rem;
	}

	.content-header .subtitle {
		font-size: 1rem;
		margin-top: 0;
	}

	/* Bottom navigation adjustments */
	.bottom-nav {
		border-radius: 0;
	}

	.bottom-nav-section {
		display: none;
		/* Hide section names to save space */
	}

	/* Page divider for tiny screens */
	.page-divider {
		margin: var(--spacing-xs) 0;
	}

	/* Mobile navigation toggle positioning */
	.show-nav-toggle {
		top: 10px;
		left: 10px;
	}
}

/* Page dividers with numbers */
.page-divider {
	position: relative;
	text-align: center;
	margin: var(--spacing-xl) 0;
	height: 24px;
	display: flex;
	align-items: center;
	justify-content: center;
}

.page-divider::before,
.page-divider::after {
	content: '';
	flex-grow: 1;
	height: 1px;
	background: var(--border-color);
	margin: 0 var(--spacing-md);
}

.page-number {
	font-family: var(--heading-font);
	color: var(--text-light);
	font-size: 1rem;
	background: #fff;
	height: 36px;
	width: 36px;
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 50%;
	border: 1px solid var(--border-color);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
	transition: all 0.3s ease;
}

.section-inner:hover .page-number {
	transform: translateY(-2px);
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
	border-color: var(--accent-color);
	color: var(--accent-color);
}

/* Minimal hover bottom navigation */
.bottom-nav-trigger {
	position: fixed;
	bottom: 0;
	left: 0;
	right: 0;
	height: 30px;
	z-index: 90;
}

.bottom-nav {
	position: fixed;
	bottom: 0;
	left: 50%;
	transform: translateX(-50%) translateY(100%);
	background: rgba(255, 255, 255, 0.95);
	border-top-left-radius: 8px;
	border-top-right-radius: 8px;
	box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.08);
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 8px 16px;
	min-width: 300px;
	max-width: 90%;
	backdrop-filter: blur(8px);
	border: 1px solid rgba(0, 0, 0, 0.08);
	border-bottom: none;
	transition: transform 0.3s ease;
	z-index: 95;
}

.bottom-nav-trigger:hover + .bottom-nav,
.bottom-nav:hover {
	transform: translateX(-50%) translateY(0);
}

.bottom-nav-section {
	font-size: 0.9rem;
	color: var(--text-color);
	text-align: center;
	flex-grow: 1;
	padding: 0 16px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

.bottom-nav-button {
	background: none;
	border: none;
	color: var(--primary-color);
	cursor: pointer;
	padding: 6px 12px;
	display: flex;
	align-items: center;
	gap: 6px;
	font-size: 0.9rem;
	transition: all 0.2s ease;
	border-radius: 4px;
}

.bottom-nav-button:hover {
	background-color: rgba(var(--primary-color-rgb), 0.08);
}

/* Add color indicators to the sidebar navigation */
.nav-chapter::before {
	content: "";
	display: block;
	width: 4px;
	height: 16px;
	position: absolute;
	left: 0;
	top: 50%;
	transform: translateY(-50%);
	border-radius: 0 2px 2px 0;
	opacity: 0.7;
}

/* Cover link indicator */
.nav-chapter[href="#cover"]::before {
	background-color: var(--section-cover-bg);
	border: 1px solid var(--border-color);
}

/* About link indicator */
.nav-chapter[href="#about"]::before {
	background-color: var(--section-about-bg);
}

/* Chapters link indicator */
.nav-chapter[href="#chapters"]::before {
	background-color: var(--section-chapters-bg);
}

/* Chapter 1 link indicator */
.nav-chapter[href="#chapter1-intro"]::before {
	background-color: var(--section-chapter1-bg);
}

/* Chapter 2 link indicator */
.nav-chapter[href="#chapter2-intro"]::before {
	background-color: var(--section-chapter2-bg);
}

/* Chapter 3 link indicator */
.nav-chapter[href="#chapter3-definition"]::before {
	background-color: var(--section-chapter3-bg);
}

/* Sidebar actions container */
.sidebar-actions {
	display: flex;
	align-items: center;
	gap: var(--spacing-sm);
}

/* Color legend toggle button */
.color-legend-toggle {
	display: none;
}

/* Update color legend styles to be a sidebar panel instead of tooltip */
.color-legend {
	background-color: rgba(255, 255, 255, 0.95);
	border-radius: 8px;
	padding: var(--spacing-sm) var(--spacing-md);
	margin: 0 var(--spacing-sm) var(--spacing-md);
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	font-size: 0.9rem;
	position: relative;
	width: auto;
	display: block;
	z-index: 10;
	opacity: 1;
	pointer-events: auto;
	transition: opacity 0.3s ease, transform 0.3s ease;
}

/* Remove existing tooltip styles */
.sidebar.mini-collapsed .color-legend,
.sidebar.collapsed .color-legend {
	display: none;
}

/* Update heading styles for the panel */
.color-legend h3 {
	font-size: 0.9rem;
	margin: 0 0 var(--spacing-xs);
	color: var(--text-primary);
}

.color-legend p {
	margin: 0 0 var(--spacing-xs);
	font-size: 0.8rem;
}

/* Mini-collapsed state - hide the color legend */
.sidebar.mini-collapsed .color-legend {
	display: none;
}

/* Legend items styling */
.legend-items {
	display: flex;
	flex-direction: column;
	gap: var(--spacing-xs);
}

.legend-item {
	display: flex;
	align-items: center;
	gap: var(--spacing-xs);
}

.color-sample {
	width: 16px;
	height: 16px;
	border-radius: 4px;
	border: 1px solid rgba(0, 0, 0, 0.1);
}

/* Sidebar panel class for consistent styling */
.sidebar-panel {
	background-color: rgba(255, 255, 255, 0.95);
	border-radius: 8px;
	margin: 0 var(--spacing-sm) var(--spacing-md);
	padding: var(--spacing-sm);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* Sidebar collapsed state - ultra minimal view */
.sidebar.mini-collapsed {
	width: 60px !important;
	/* Force fixed width, override fit-content */
	min-width: 60px;
	max-width: 60px;
	overflow: hidden;
	background-color: rgba(255, 255, 255, 0.8);
	backdrop-filter: blur(8px);
	-webkit-backdrop-filter: blur(8px);
	border-right: 1px solid rgba(255, 255, 255, 0.7);
	box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

/* Hide most elements in mini-collapsed state */
.sidebar.mini-collapsed .sidebar-header,
.sidebar.mini-collapsed .sidebar-nav,
.sidebar.mini-collapsed .search-container,
.sidebar.mini-collapsed .sidebar-actions {
	overflow: hidden;
}

/* Adjust logo in mini-collapsed state */
.sidebar.mini-collapsed .logo h1 {
	display: none;
}

.sidebar.mini-collapsed .logo {
	justify-content: center;
	padding: var(--spacing-sm);
	width: 100%;
	display: flex;
	align-items: center;
}

.sidebar.mini-collapsed .logo i {
	margin: 0;
	/* Remove any margin that might cause misalignment */
	font-size: 22px;
	/* Standardize icon size */
}

/* Show only chapter circles in mini-collapsed state */
.sidebar.mini-collapsed .nav-chapter span,
.sidebar.mini-collapsed .nav-chapter .page-num,
.sidebar.mini-collapsed .nav-subchapter {
	display: none;
}

.sidebar.mini-collapsed .nav-chapter {
	justify-content: center;
	padding: var(--spacing-xs) 0;
	height: auto;
}

.sidebar.mini-collapsed .subchapter-list {
	display: none;
}

/* Make chapter numbers more prominent */
.sidebar.mini-collapsed .chapter-number {
	margin: 0;
	width: 36px;
	/* Fixed width to prevent cutoff */
	height: 36px;
	/* Fixed height to prevent cutoff */
	display: flex;
	align-items: center;
	justify-content: center;
}

/* Adjust sidebar actions in mini-collapsed state */
.sidebar.mini-collapsed .sidebar-actions {
	justify-content: center;
	padding: var(--spacing-sm) 0;
}

/* Adjust resize handle for mini-collapsed state */
.sidebar.mini-collapsed .sidebar-resize-handle {
	right: 0;
}

/* Adjust main content margin for mini-collapsed state */
.sidebar.mini-collapsed + .main-content {
	margin-left: 60px;
}

/* Improve interactivity for mini-collapsed elements */
.sidebar.mini-collapsed .chapter-number,
.sidebar.mini-collapsed .logo i,
.sidebar.mini-collapsed .search-container i {
	cursor: pointer;
	transform: scale(1);
	transition: transform 0.2s ease;
}

.sidebar.mini-collapsed .chapter-number:hover,
.sidebar.mini-collapsed .logo i:hover,
.sidebar.mini-collapsed .search-container i:hover {
	transform: scale(1.15);
}

/* Improve sidebar transitions for all elements */
.sidebar .logo,
.sidebar .sidebar-header,
.sidebar .sidebar-nav,
.sidebar .sidebar-actions,
.sidebar .search-container,
.sidebar .chapter-number,
.sidebar .nav-chapter span,
.sidebar .nav-chapter .page-num,
.sidebar .nav-subchapter {
	transition: all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Add transition classes for specific states */
.sidebar.mini-collapsed,
.sidebar.collapsed {
	transition-duration: 0.4s;
	transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Center search icon in mini-collapsed state */
.sidebar.mini-collapsed .search-container {
	padding: var(--spacing-sm) 0;
	justify-content: center;
	display: flex;
	align-items: center;
	width: 100%;
}

.sidebar.mini-collapsed .search-container input {
	display: none;
}

.sidebar.mini-collapsed .search-container i {
	position: static;
	margin: 0 auto;
	padding: var(--spacing-sm);
	cursor: pointer;
	color: var(--text-color);
	opacity: 1;
	font-size: 18px;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* Sidebar close button - hidden by default (only for mobile) */
.sidebar-close {
	display: none;
}

@media (max-width: 768px) {
	.sidebar-close {
		display: block;
	}
}

/* Create a button container at the bottom for additional controls */
.visualization-container .viz-mobile-controls {
	position: absolute;
	bottom: 8px;
	left: 0;
	right: 0;
	display: flex;
	justify-content: space-between;
	padding: 0 8px;
	z-index: 10;
}

/* Chapter color guide */
.color-guide-section {
	background-color: var(--bg-light);
	border-radius: 8px;
	padding: var(--spacing-md);
	margin-bottom: var(--spacing-lg);
}

.chapter-color-guide {
	display: flex;
	flex-wrap: wrap;
	gap: var(--spacing-md);
	margin-top: var(--spacing-sm);
	justify-content: center;
}

.chapter-color-guide .legend-item {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: 8px;
	min-width: 80px;
}

.chapter-color-guide .color-sample {
	width: 40px;
	height: 40px;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.chapter-color-guide .legend-item span {
	font-size: 14px;
	font-weight: 500;
}

/* Mobile styles for the chapter color guide */
@media (max-width: 768px) {
	.chapter-color-guide {
		gap: var(--spacing-sm);
	}

	.chapter-color-guide .legend-item {
		min-width: 70px;
	}

	.chapter-color-guide .color-sample {
		width: 30px;
		height: 30px;
	}
}

/* Tablet-specific styles - make sidebar overlay content */
@media (min-width: 481px) and (max-width: 768px) {

	/* Tablet-specific sidebar adjustments */
	.sidebar {
		width: 320px;
		max-width: 85%;
		background-color: rgba(255, 255, 255, 0.75);
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
		border-right: 1px solid rgba(255, 255, 255, 0.7);
	}

	/* Adjust sidebar header for better tablet layout */
	.sidebar-header {
		padding: var(--spacing-md) var(--spacing-sm);
		padding-right: 50px;
		/* Make room for close button */
	}

	/* Ensure the sidebar actions work correctly */
	.sidebar-actions {
		display: flex;
		align-items: center;
		justify-content: flex-end;
	}
}

/* Shared styles for navigation toggle on mobile devices */
@media (max-width: 768px) {

	/* Show navigation toggle button */
	.show-nav-toggle {
		display: flex !important;
		position: fixed;
		z-index: 999;
		width: 56px;
		height: 56px;
		background-color: rgba(44, 62, 80, 0.9);
		color: white;
		border-radius: 50%;
		align-items: center;
		justify-content: center;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
		cursor: pointer;
		transition: transform 0.2s ease, background-color 0.2s ease;
	}

	.show-nav-toggle:hover {
		transform: scale(1.05);
	}
}

/* Tablet-specific position for FAB */
@media (min-width: 481px) and (max-width: 768px) {
	.show-nav-toggle {
		bottom: 30px;
		right: 30px;
	}
}

/* Phone-specific position for FAB */
@media (max-width: 480px) {
	.show-nav-toggle {
		top: 20px;
		left: 20px;
	}
}

/* Show nav toggle for mobile view */
@media (max-width: 480px) {
	.show-nav-toggle {
		bottom: 0.75rem;
		right: 0.75rem;
	}
}

/* About page specific styles */
@media (max-width: 768px) {
	.desktop-only {
		display: none;
		margin-top: 1rem;
		overflow: hidden;
		transition: max-height 0.3s ease-out;
	}

	.desktop-only.expanded {
		display: block;
		animation: fadeIn 0.3s ease-out;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(-5px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.expand-text-btn {
		display: inline-flex;
		align-items: center;
		background: transparent;
		border: none;
		border-radius: 0;
		padding: 0.5rem 0;
		margin: 0.8rem 0 0.5rem;
		font-size: 1rem;
		color: var(--primary-color);
		cursor: pointer;
		font-weight: 500;
		transition: all 0.2s ease;
		text-decoration: none;
	}

	.expand-text-btn:hover,
	.expand-text-btn:focus {
		color: var(--primary-color-dark);
		transform: translateX(3px);
		outline: none;
	}

	.expand-text-btn:active {
		transform: translateX(5px);
	}

	.expand-arrow {
		display: inline-block;
		margin-left: 8px;
		font-style: normal;
		transition: transform 0.2s ease;
		font-weight: bold;
	}

	.expand-text-btn[aria-expanded="true"] .expand-arrow {
		transform: rotate(90deg);
	}
}

@media (min-width: 769px) {
	.expand-text-btn {
		display: none;
	}
}

/* Reduce font size for feature item headings to prevent overflow */
.feature-item h3 {
	font-size: 1.1rem;
	line-height: 1.3;
	margin-bottom: 0.5rem;
}